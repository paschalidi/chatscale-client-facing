{"version":3,"sources":["../src/context/ChatContext/index.tsx","../src/config.ts","../src/components/ChatList/index.tsx","../src/components/MessageInput/index.tsx","../src/components/Messages/index.tsx"],"sourcesContent":["import * as React from 'react';\nimport { ChatProviderProps } from \"./types\";\nimport { config } from \"../../config\";\n\ninterface ChatContextType {\n  organizationToken: string;\n  channelName: string;\n  isConnected: boolean;\n  wsEndpoint: string;\n  ws: WebSocket | null;\n  messages: Message[];\n}\nconst ChatContext = React.createContext<ChatContextType | null>(null);\n\ninterface Message {\n  id: string;\n  user_id: string;\n  room_id: string;\n  content: string;\n  timestamp: number;\n}\n\nconst getChannelName = () => {\n  if (typeof window !== 'undefined') {\n    const searchParams = new URLSearchParams(window.location.search);\n    return searchParams.get('cn') || 'public';\n  }\n  return 'public'; // Default fallback\n};\n\nexport const ChatProvider: React.FC<ChatProviderProps> = ({\n                                                            children,\n                                                            organizationToken,\n                                                            options = {\n                                                              reconnectInterval: 3000,\n                                                              maxReconnectAttempts: 5,\n                                                              debug: false\n                                                            }\n                                                          }) => {\n  const channelName = getChannelName();\n  const wsEndpoint = `${config.rust_ws_url}/chat/${channelName}`;\n  const [isConnected, setIsConnected] = React.useState(false);\n  const ws = React.useRef<WebSocket | null>(null);\n  const reconnectAttempts = React.useRef(0);\n  const reconnectTimeout = React.useRef<number>();\n  const [messages, setMessages] = React.useState<Message[]>([]);\n\n  const connect = React.useCallback(() => {\n    console.log('Connecting to WebSocket', wsEndpoint);\n    try {\n      ws.current = new WebSocket(wsEndpoint);\n\n      ws.current.onopen = () => {\n        setIsConnected(true);\n        reconnectAttempts.current = 0;\n        if (options.debug) console.log('Connected to WebSocket');\n      };\n\n      ws.current.onmessage = (event) => {\n        const data = JSON.parse(event.data);\n\n        if (options.debug) {\n          console.log('Received message:', data);\n        }\n\n        // Add new message to state\n        setMessages(prev => [...prev, {\n          id: crypto.randomUUID(),\n          user_id: \"data.user_id\", // @todo get a real user_id\n          room_id: \"data.user_id\",\n          content: data.content,\n          timestamp: Date.now()\n        }]);\n      };\n\n      ws.current.onclose = () => {\n        setIsConnected(false);\n        if (reconnectAttempts.current < (options.maxReconnectAttempts || 5)) {\n          reconnectTimeout.current = window.setTimeout(connect, options.reconnectInterval);\n          reconnectAttempts.current += 1;\n          if (options.debug) console.log(`Reconnect attempt ${reconnectAttempts.current}`);\n        }\n      };\n\n      ws.current.onerror = (error) => {\n        if (options.debug) console.error('WebSocket error:', error);\n      };\n\n    } catch (error) {\n      if (options.debug) console.error('WebSocket connection error:', error);\n    }\n  }, [wsEndpoint]);\n\n  React.useEffect(() => {\n    connect();\n\n    return () => {\n      if (reconnectTimeout.current) {\n        window.clearTimeout(reconnectTimeout.current);\n      }\n      if (ws.current) {\n        ws.current.close();\n        ws.current = null;\n      }\n    };\n  }, []);\n\n  const value = React.useMemo(() => ({\n    organizationToken,\n    channelName,\n    wsEndpoint,\n    isConnected,\n    messages,\n    ws: ws.current\n  }), [organizationToken, wsEndpoint, isConnected,messages]);\n\n  return (\n    <ChatContext.Provider value={value}>\n      {children}\n    </ChatContext.Provider>\n  );\n};\n\nexport const useChat = () => {\n  const context = React.useContext(ChatContext);\n  if (!context) {\n    throw new Error('useChat must be used within a ChatProvider');\n  }\n  return context;\n};","export const config = {\n  rust_api_url: 'https://api.chatscale.cloud/api',\n  rust_ws_url: 'wss://api.chatscale.cloud/ws',\n};","import * as React from 'react';\nimport { Chat, ChatListProps } from './types';\nimport { useChat } from \"../../context/ChatContext\";\n\nexport const ChatList: React.FC<ChatListProps> = ({\n                                                    limit = 50,\n                                                    onChatSelect,\n                                                    customStyles = {},\n                                                    renderItem\n                                                  }) => {\n  const { organizationToken } = useChat();\n  const [chats, setChats] = React.useState<Chat[]>([]);\n  const [isLoading, setIsLoading] = React.useState(true);\n\n  React.useEffect(() => {\n    const fetchChats = async () => {\n      try {\n        const response = await fetch(`/api/chats?limit=${limit}`, {\n          headers: {\n            'Authorization': `Bearer ${organizationToken}`\n          }\n        });\n        const data = await response.json();\n        setChats(data);\n      } catch (error) {\n        console.error('Error fetching chats:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchChats();\n  }, [organizationToken, limit]);\n\n  if (isLoading) {\n    return <div>Loading chats...</div>;\n  }\n\n  return (\n    <div className={customStyles.container}>\n      {chats.map((chat) => (\n        <div\n          key={chat.id}\n          onClick={() => onChatSelect?.(chat.id)}\n          className={customStyles.chatItem}\n        >\n          {renderItem ? (\n            renderItem(chat)\n          ) : (\n            <div>\n              <h3>{chat.name}</h3>\n              {chat.lastMessage && <p>{chat.lastMessage}</p>}\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};","import * as React from 'react';\nimport { MessageInputProps } from './types';\nimport { useChat } from '../../context/ChatContext';\n\nexport const MessageInput: React.FC<MessageInputProps> = ({\n                                                            placeholder = 'Type a message...',\n                                                            onSend,\n                                                            maxLength = 1000,\n                                                            disabled = false\n                                                          }) => {\n  const [message, setMessage] = React.useState('');\n  const { ws, isConnected } = useChat();\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (message.trim() && ws && isConnected) {\n      ws.send(JSON.stringify({\n        \"user_id\": \"bob_dev\",\n        \"room_id\": \"tech_support\",\n        \"content\": message,\n        \"timestamp\": 0\n      }));\n      onSend?.(message);\n      setMessage('');\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"flex gap-2\">\n      <input\n        type=\"text\"\n        value={message}\n        onChange={(e) => setMessage(e.target.value)}\n        placeholder={placeholder}\n        maxLength={maxLength}\n        disabled={disabled || !isConnected}\n        className=\"flex-1 px-3 py-2 rounded border\"\n      />\n      <button\n        type=\"submit\"\n        disabled={disabled || !message.trim() || !isConnected}\n        className=\"px-4 py-2 rounded disabled:opacity-50\"\n      >\n        Send\n      </button>\n    </form>\n  );\n};","import * as React from 'react';\nimport { Message, MessagesProps } from './types';\nimport { useChat } from '../../context/ChatContext';\n\nexport const Messages: React.FC<MessagesProps> = ({\n                                                    className = '',\n                                                    containerClassName = '',\n                                                    messageClassName = '',\n                                                    renderMessage\n                                                  }) => {\n  const { messages } = useChat();\n  const messagesEndRef = React.useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  React.useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const defaultRenderMessage = (message: Message) => (\n    <div\n      className={`p-4 rounded-lg ${\n        message.user_id === 'me'\n          ? 'bg-blue-500 text-white ml-auto'\n          : 'bg-gray-100'\n      } ${messageClassName}`}\n    >\n      <div className=\"flex justify-between items-start gap-2\">\n        <span className=\"font-medium\">{message.user_id}</span>\n        <span className=\"text-xs opacity-70\">\n          {new Date(message.timestamp * 1000).toLocaleTimeString()}\n        </span>\n      </div>\n      <p className=\"mt-1\">{message.content}</p>\n    </div>\n  );\n\n  return (\n    <div className={`flex flex-col h-full ${className}`}>\n      <div className={`flex-1 overflow-y-auto p-4 space-y-4 ${containerClassName}`}>\n        {messages.map((message, index) => (\n          <div key={index} className=\"max-w-[70%]\">\n            {renderMessage ? renderMessage(message) : defaultRenderMessage(message)}\n          </div>\n        ))}\n        <div ref={messagesEndRef}/>\n      </div>\n    </div>\n  );\n};"],"mappings":"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","names":["React","React","React"]}